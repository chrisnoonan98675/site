{% comment %}
List all topics with a certain subject.
The category must be captured by a for loop because a topic can have multiple categories.

XL Deploy plugins have an additional property called the 'display subject'.
This allows you to build a page such as 'middleware plugins' and group topics on that page by middleware type (jboss, was, etc.).

Do not indent the code block between the unless/endunless tags.
{% endcomment %}

{% unless jekyll.environment == "lightweight" %}
{% capture this_category %}{% for category in page.categories %}{{ category }}{% endfor %}{% endcapture %}
{% assign this_subject = page.subject %}

<ul>
	{% for node in site.weighted_pages %}
		{% unless node.url contains '/subject/' %}
			{% for category in node.categories %}
				{% if category contains this_category %}
					{% if node.subject == this_subject %}
						{% if node.display-subject %}
							<li>{{ node.display-subject }}
								<ul>
									<li><a href="{{ node.url }}">{{ node.title }}</a></li>
								</ul>
							</li>
						{% else %}
							<li><a href="{{ node.url }}">{{ node.title }}</a></li>
						{% endif %}
					{% endif %}
				{% endif %}
			{% endfor %}
		{% endunless %}
	{% endfor %}
</ul>
{% endunless %}
