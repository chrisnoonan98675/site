{% comment %}
List all topics with a certain subject.
The category must be captured by a for loop because a topic can have multiple categories.

Do not indent the code block between the jekyll.environment unless/endunless tags.
{% endcomment %}

{% unless jekyll.environment == "lightweight" %}
{% capture this_category %}{% for category in page.categories %}{{ category }}{% endfor %}{% endcapture %}
{% assign this_subject = page.subject %}

<ul>
	{% for node in site.weighted_pages %}
		{% unless node.url contains '/subject/' %}
			{% for category in node.categories %}
				{% if category contains this_category %}
					{% if node.subject == this_subject %}
						<li><a href="{{ node.url }}">{{ node.title }}</a></li>
					{% endif %}
				{% endif %}
			{% endfor %}
		{% endunless %}
	{% endfor %}
</ul>
{% endunless %}
